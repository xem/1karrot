<body id=b>
<script>

// =====================
//  Can I Has 1Karrot ?
// =====================

// The magician's rabbit has escaped the stage and is looking for his carrot in a strange forest...
// Controls: Arrow keys or WASD or ZQSD.
// JS1k demo by Maxime EUZIERE (http://xem.github.io), rendered only with CSS3D and emoji characters.
// Optimized for running on latest Windows 10 and Webkit browsers.
// Can also run on latest Mac OS (but the emoji are quite ugly).
// Can also run on Firefox (but it's a little glitchy).
// Linux users will see monochrome emoji or black squares, so they should install the Emoji One font:
// Download https://goo.gl/J7GbE6 => right-click on the file => install as system font.
// The demo abuses HTML & CSS hacks to save space, and repeats a lot of code to optimize for RegPack.
// Minified code is 1817 bytes long, RegPack'd code is 1023 bytes long.
// This demo generates about 20kb of HTML code.

// Initializations
// ---------------

// Frame counter
t =

// Tree counter
q =

// Up / down / left / right keys pressed
u = d = l = r = 0;

// Game loop
// ---------

// The content of this function is sent to RegPack.
// (Settings: do not rename var "b", score: 1/1/0)
// The result (999 bytes long) is then placed in the following snippet without the final eval statement:
// t=H=u=d=l=r=0;(PACKED CODE);setInterval(_,33)
// Which makes a total of 1023 bytes.
setInterval(function(e){

// If the game has started (t > 0):
// On load, t==0, so this part of the code is ignored.
// Then, it is executed at each frame.
t
?(

  // backup the value of x and y (the rabbit's position).
  v = x,
  w = y,
  
  // Update the rabbit's x, y and angle (a) according to the keys pressed:
  // the angle a is incremented or decremented of 1/30 radian with left and right keys.
  // Then x and y are incremented or decremented of 1/9 inch along this angle with up and down keys.
  // (d-u) and (l-r) are equal to 1 or -1 according to the keys pressed.
  // If no key is pressed, (d-u) and (l-r) are equal to zero, so the rabbit doesn't move.
  x += (d - u) / 9 * Math.sin(
    a += (l - r) / 30
  ),
  y += (d - u) / 9 * Math.cos(a),
  
  // Prevent the rabbit from going out of bounds (negative x or y) or out of the brown path:
  // Check if x > 0, y > 0 or if the tile below the rabbit belongs to the path.
  // (Tiles measure 3in * 3 in, so we're on the path if the ~~(x/3)th bit of the ~~(y/3)th value of m == 1)
  // If one of these three conditions is not fullfilled, revert x and y to their backup values.
  // This is how the game's collisions work.
  x > 0 && y > 0 && m[~~(y / 3)] >> ~~(x / 3) & 1 || (x = v, y = w),
  
  // Place the rabbit on the scene according to x, y and a.
  // On the Z coordinate, the frame counter is passed to 3-Math.sin(t/5):
  // This makes the rabbit jump at the right speed and height, in em.
  // the final rotateX(5rad) is used to make the rabbit less vertical, and more slanted towards the camera.
  // In CSS, the last closing parenthesis of a rule can be omitted to save a byte.
  h.style.transform = `translate3D(${x}in,${y}in,${3 - Math.sin(t / 5)}em)rotateZ(${-a}rad)rotateX(5rad`
)

// If the game hasn't started yet:
// This code is only executed once, on load.
:
  
  // On the first frame, write some HTML inside the body element (called b).
  b.innerHTML =
  
  // The scene container, used to set the viewport's height (95vh), perspective (7in) and background (green).
  // overflow:hidden obviously prevent to draw anything outside the viewport.
  `<div style=height:95vh;perspective:7in;overflow:hidden;background:#6e0>`
  +
    // The scene (called "s"), used to force "preserve-3D" (otherwise, the rendering would be isometric),
    // and place everything around the center of the viewport (top: 50vh, left: 50%).
    // "margin:50vh+50%" is the same as "margin:50vh 50%", but without space.
    // Without spaces in the style attribute, the attribute quotes can be omitted.
    `<div style=transform-style:preserve-3d;margin:3in+50% id=s>`
      
    +

    // The carrot and the 8 animals:
    // They're placed in <a> elements because consecutive <a>'s don't require closing tags (</a>).
    // Their id have the same form as the trees id's, because they'll behave almost the same way.
    // Like the trees ids, the id of these elements have the form t${y}${x}.
    // position:fixed is used to place these elements on the top-left corner of the scene.
    // "font:3em''" is the same as "font:3em sans-serif", but shorter and without spaces.
    // the padding-top is used to place these elements 2em lower than the trees.
    `<a style=position:fixed;font:3em'';padding:2em+0+0 id=t515>🥕
    <a style=position:fixed;font:3em'';padding:2em+0+0 id=t010>🐒
    <a style=position:fixed;font:3em'';padding:2em+0+0 id=t40>🐍
    <a style=position:fixed;font:3em'';padding:2em+0+0 id=t114>🐆
    <a style=position:fixed;font:3em'';padding:2em+0+0 id=t59>🦍
    <a style=position:fixed;font:3em'';padding:2em+0+0 id=t24>🐌
    <a style=position:fixed;font:3em'';padding:2em+0+0 id=t012>🐂
    <a style=position:fixed;font:3em'';padding:2em+0+0 id=t10>🐥
    <a style=position:fixed;font:3em'';padding:2em+0+0 id=t38>🐢`
    
    +
    
    // The rabbit, called "h".
    // navigator.platform[5] is true on Mac OS and false on Windows and Linux
    // On Mac OS, the rabbit's width is set to .6in. On other OS's, .7em.
    // Mac OS emoji are not rendered with the same alignment,
    // so this custom width allows the rabbit's head to be right above the hat.
    `<a style=position:fixed;width:.${navigator.platform[5]?6:7}in;font:3em'' id=h>🐰`
    
      +
      
      // The rabbit's hat, reversed with "scale(-1)".
      // The hat's line-height is .1in on MacOS and .5in on other OS's,
      // and the 9px translateY allows to place it just on the bottom of the rabbit's head.
      `<div style=font:60px/.${navigator.platform[5]?1:5}in'';transform:scale(-1)translateY(9px>🎩`
;

//
for(i in m = [5120,22511,29732,13540,29829,57087])
  
  //
  for(j = 16; j--;)
    
    //
    t
    ?
      
      //
      this[`t${i + j}`] && (
        
        //
        this[`t${i + j}`].style.transform = `translate3D(${j*3+2}in,${i*3+1.5}in,${navigator.platform[5]?1.5:2}in)rotateZ(${-a}rad)rotateX(5rad)rotateY(${this[`t${i+j}`].tagName[2]?0:Math.sin(t/5)/5}rad)scale(2.5`,
        
        //
        x > 46 ? (
          
          //
          s.style.transition = `5s`,
          
          //
          a=0,
          
          //
          s.style.transform=`rotateX(.5rad)translate3D(-23in,-23in,-23in`
        )
        
        //
        : s.style.transform=`rotateX(.7rad)rotateZ(${a}rad)translate(${-x}in,${-y}in`
        
      )
    
    //
    :(
      
      //
      s.innerHTML +=
      
      //
      m[i] >> j & 1
      
      //
      ? `<div style=position:fixed;padding:1.51in;background:#961;transform:translate(${j * 3 + .5}in,${i * 3 + .5}in>`
      
      //
      :
        q++ % 8 && q
      
        //
        ? `<div style=position:fixed;font:7em'' id=t${i + j}>`
          
          //
          + [...`🌳🌲🌵🌴`][q % 4]
      
        //
        : ``,
      
    //
    onkeydown= e => this['lurdl*d*l*ur*u'[(e.which + 3) % 20]] = 1,
    
    //
    onkeyup = e => this['lurdl*d*l*ur*u'[(e.which + 3) % 20]] = 0,
    
    //
    x = 3,
    
    //
    y = a = 5
  );

//
t++

},33)
</script>